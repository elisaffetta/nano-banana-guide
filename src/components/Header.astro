---
import type { Props } from '@astrojs/starlight/props';
import StarlightHeader from '@astrojs/starlight/components/Header.astro';
import CustomThemeToggle from './CustomThemeToggle.astro';
---

<StarlightHeader {...Astro.props} />

<!-- ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº ÐºÐ»Ð¸ÐºÐ° Ð´Ð»Ñ ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð±Ð¾Ñ‚Ð° -->
<script>
  function handleBotButtonClick() {
    document.addEventListener('click', function(e) {
      const rightGroup = e.target.closest('.right-group');
      if (rightGroup) {
        const rect = rightGroup.getBoundingClientRect();
        const pseudoWidth = 180; // ÑˆÐ¸Ñ€Ð¸Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð±Ð¾Ñ‚Ð°
        const toggleWidth = 60; // ÑˆÐ¸Ñ€Ð¸Ð½Ð° Ñ‚Ð¾Ð³Ð³Ð»Ð° Ñ‚ÐµÐ¼Ñ‹
        const toggleOffset = rect.width - toggleWidth - 10; // Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ Ñ‚Ð¾Ð³Ð³Ð»Ð°
        
        // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÐºÐ»Ð¸Ðº Ð¿Ð¾ ÐºÐ½Ð¾Ð¿ÐºÐµ Ð±Ð¾Ñ‚Ð° (ÑÐ»ÐµÐ²Ð°)
        if (e.clientX >= rect.left && e.clientX <= rect.left + pseudoWidth) {
          window.open('https://t.me/nanobananas_bot', '_blank');
          console.log('Bot button clicked');
        }
        // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÐºÐ»Ð¸Ðº Ð¿Ð¾ Ñ‚Ð¾Ð³Ð³Ð»Ñƒ Ñ‚ÐµÐ¼Ñ‹ (ÑÐ¿Ñ€Ð°Ð²Ð°)
        else if (e.clientX >= rect.left + toggleOffset && e.clientX <= rect.right) {
          toggleDesktopTheme();
          console.log('Desktop theme toggle clicked');
        }
      }
    });
  }

  function toggleDesktopTheme() {
    const currentTheme = localStorage.getItem('starlight-theme') || 'auto';
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    
    localStorage.setItem('starlight-theme', newTheme);
    document.documentElement.setAttribute('data-theme', newTheme);
    
    // Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð¸Ñ€ÑƒÐµÐ¼ Ñ Ð¾Ñ€Ð¸Ð³Ð¸Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¼ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°Ñ‚ÐµÐ»ÐµÐ¼ Starlight
    const starlightSelect = document.querySelector('starlight-theme-select select');
    if (starlightSelect) {
      starlightSelect.value = newTheme;
      starlightSelect.dispatchEvent(new Event('change'));
    }
  }

  function addMobileSettings() {
    // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ñ‡Ñ‚Ð¾ ÑÑ‚Ð¾ Ð¼Ð¾Ð±Ð¸Ð»ÑŒÐ½Ð¾Ðµ ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð¾
    if (window.innerWidth > 768) return;
    
    const sidebarContent = document.querySelector('.sidebar-content');
    if (!sidebarContent) return;
    
    // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ð½Ðµ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ñ‹ Ð»Ð¸ ÑƒÐ¶Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸
    if (sidebarContent.querySelector('.mobile-settings')) return;
    
    // Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº
    const settingsContainer = document.createElement('div');
    settingsContainer.className = 'mobile-settings';
    
    // ÐšÐ½Ð¾Ð¿ÐºÐ° Ð±Ð¾Ñ‚Ð°
    const botButton = document.createElement('a');
    botButton.href = 'https://t.me/nanobananas_bot';
    botButton.className = 'mobile-bot-button';
    botButton.target = '_blank';
    botButton.rel = 'noopener noreferrer';
    botButton.innerHTML = 'ðŸ¤– ÐŸÐ¾Ð¿Ñ€Ð¾Ð±Ð¾Ð²Ð°Ñ‚ÑŒ Ð±Ð¾Ñ‚Ð°';
    
    // Ð ÑÐ´ Ñ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°Ñ‚ÐµÐ»ÐµÐ¼ Ñ‚ÐµÐ¼Ñ‹
    const themeRow = document.createElement('div');
    themeRow.className = 'mobile-theme-row';
    
    const themeLabel = document.createElement('span');
    themeLabel.className = 'mobile-theme-label';
    themeLabel.textContent = 'Ð¢ÐµÐ¼Ð°';
    
    const themeToggle = document.createElement('button');
    themeToggle.id = 'mobile-custom-theme-toggle';
    themeToggle.className = 'custom-theme-toggle';
    themeToggle.setAttribute('aria-label', 'ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ñ‚ÐµÐ¼Ñƒ');
    
    themeRow.appendChild(themeLabel);
    themeRow.appendChild(themeToggle);
    
    // Ð¡Ð¾Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð²ÑÑ‘ Ð²Ð¼ÐµÑÑ‚Ðµ
    settingsContainer.appendChild(botButton);
    settingsContainer.appendChild(themeRow);
    
    // Ð’ÑÑ‚Ð°Ð²Ð»ÑÐµÐ¼ Ð² Ð½Ð°Ñ‡Ð°Ð»Ð¾ ÑÐ°Ð¹Ð´Ð±Ð°Ñ€Ð°
    sidebarContent.insertBefore(settingsContainer, sidebarContent.firstChild);
    
    // Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð¸Ñ€ÑƒÐµÐ¼ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°Ñ‚ÐµÐ»ÑŒ Ñ‚ÐµÐ¼Ñ‹
    initMobileThemeToggle();
  }

  function initMobileThemeToggle() {
    const toggle = document.getElementById('mobile-custom-theme-toggle');
    if (!toggle) return;

    function getCurrentTheme() {
      return localStorage.getItem('starlight-theme') || 'auto';
    }

    function setTheme(theme) {
      localStorage.setItem('starlight-theme', theme);
      document.documentElement.setAttribute('data-theme', theme);
      
      // Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð¸Ñ€ÑƒÐµÐ¼ Ñ Ð¾Ñ€Ð¸Ð³Ð¸Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¼ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°Ñ‚ÐµÐ»ÐµÐ¼ Starlight
      const starlightSelect = document.querySelector('starlight-theme-select select');
      if (starlightSelect) {
        starlightSelect.value = theme;
        starlightSelect.dispatchEvent(new Event('change'));
      }
    }

    function toggleTheme() {
      const currentTheme = getCurrentTheme();
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      setTheme(newTheme);
    }

    toggle.addEventListener('click', toggleTheme);
  }

  document.addEventListener('DOMContentLoaded', () => {
    handleBotButtonClick();
    addMobileSettings();
  });
  
  document.addEventListener('astro:page-load', () => {
    handleBotButtonClick();
    addMobileSettings();
  });
  
  // ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ Ð¿Ñ€Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¸ Ñ€Ð°Ð·Ð¼ÐµÑ€Ð° ÑÐºÑ€Ð°Ð½Ð°
  window.addEventListener('resize', () => {
    if (window.innerWidth <= 768) {
      addMobileSettings();
    }
  });
</script>

